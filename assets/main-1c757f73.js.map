{"version":3,"file":"main-1c757f73.js","sources":["../../src/main.ts"],"sourcesContent":["/// <reference types=\"@workadventure/iframe-api-typings\" />\n\n/* ============ LOGS ============ */\nconst L = {\n  log: (...a: any[]) => console.log(\"[WA]\", ...a),\n  err: (...a: any[]) => console.error(\"[WA]\", ...a),\n};\n\n/* ============ CONFIG ============ */\nconst MAP_URL = \"/@/ynov-1733302243/ynov_adventure/new-map\";\nconst ZONES: { id: string; label: string }[] = [\n  { id: \"#TPA-IA\", label: \"IA\" },\n  { id: \"#TPAINFO\", label: \"Informatique\" },\n  { id: \"#TPACYBER\", label: \"Cybersécurité\" },\n  { id: \"#TPAARCHI\", label: \"Architecture\" },\n  { id: \"#TPABIM\", label: \"Bâtiment Numérique\" },\n  { id: \"#TPAAUDIO\", label: \"Audiovisuel\" },\n  { id: \"#TPADIGITAL\", label: \"DIGITAL IA\" },\n  { id: \"#TPA3D\", label: \"3D\" },\n  { id: \"#TPAHUB\", label: \"Accueil\" },\n];\n\n/* ======= RÉGLAGES MENU PAGINÉ ======= */\n// Taille fixe et robuste (évite les heuristiques mobile/UA)\nconst PER_PAGE = 3;\n\n/* ============ HELPERS ============ */\n// Attend que l'action bar soit dispo (si WA n'a pas fini d'init l'UI)\nfunction waitForActionBar(maxTries = 25, delayMs = 200): Promise<void> {\n  return new Promise((resolve, reject) => {\n    let tries = 0;\n    const tick = () => {\n      const ab: any = (WA.ui as any)?.actionBar;\n      if (ab?.addButton) return resolve();\n      tries++;\n      if (tries >= maxTries) return reject(new Error(\"actionBar indisponible\"));\n      setTimeout(tick, delayMs);\n    };\n    tick();\n  });\n}\n\nfunction addButtonSafe(opts: {\n  id: string; label: string; onClick: () => void; bgColor?: string; isGradient?: boolean;\n}) {\n  const ab: any = (WA.ui as any)?.actionBar;\n  if (!ab?.addButton) { L.err(\"actionBar.addButton introuvable\"); return; }\n\n  // Évite les doublons si rechargé\n  try { ab.removeButton?.(opts.id); } catch {}\n\n  const base: any = { id: opts.id, label: opts.label, callback: opts.onClick, clickCallback: opts.onClick };\n  try {\n    if (opts.bgColor !== undefined) base.bgColor = opts.bgColor;\n    if (opts.isGradient !== undefined) base.isGradient = opts.isGradient;\n    ab.addButton(base);\n  } catch {\n    try { ab.addButton({ id: opts.id, label: opts.label, callback: opts.onClick, clickCallback: opts.onClick }); } catch {}\n  }\n}\nfunction removeButtonSafe(id: string) {\n  const ab: any = (WA.ui as any)?.actionBar;\n  try { ab?.removeButton?.(id); } catch {}\n}\n\n/* ======= ÉTAT TÉLÉPORTATION ======= */\nconst MAIN_TP_BTN_ID = \"teleport-btn\";\nlet tpOpen = false;\nlet tpPage = 0;\nlet tpButtonIds: string[] = [];\nlet unregisterMenu: Array<() => void> = [];\n\n/* ============ INIT ============ */\nWA.onInit()\n  .then(() => {\n    // Entrées PERMANENTES dans les paramètres (utile mobile)\n    registerMenuCommands();\n    return waitForActionBar();\n  })\n  .then(() => {\n    // Bouton principal en haut\n    addButtonSafe({\n      id: MAIN_TP_BTN_ID,\n      label: \"Téléportation\",\n      bgColor: \"#2ea7ff\",\n      isGradient: true,\n      onClick: () => openTeleportMenu(),\n    });\n  })\n  .catch((e) => L.err(\"Init error:\", e));\n\n/* ============ MENU PARAMÈTRES (toujours visibles) ============ */\nfunction registerMenuCommands() {\n  // Nettoyage si déjà enregistré\n  if (unregisterMenu.length) {\n    unregisterMenu.forEach((u) => { try { u(); } catch {} });\n    unregisterMenu = [];\n  }\n\n  // “Téléportation” (ouvre le menu paginé en haut)\n  try {\n    const unregTp = WA.ui.registerMenuCommand(\"Téléportation\", () => openTeleportMenu());\n    if (typeof unregTp === \"function\") unregisterMenu.push(unregTp);\n  } catch (e) { L.err(\"registerMenuCommand Téléportation error:\", e); }\n\n  // Une entrée par zone (accès direct depuis paramètres)\n  ZONES.forEach((z) => {\n    try {\n      const unreg = WA.ui.registerMenuCommand(z.label, () => {\n        try { WA.nav.goToRoom(MAP_URL + z.id); } catch (e2) { L.err(\"goToRoom error:\", e2); }\n      });\n      if (typeof unreg === \"function\") unregisterMenu.push(unreg);\n    } catch (e) {\n      L.err(`registerMenuCommand ${z.label} error:`, e);\n    }\n  });\n}\n\n/* ============ TÉLÉPORTATION (action bar paginée) ============ */\nfunction openTeleportMenu() {\n  if (tpOpen) return;\n  tpOpen = true;\n\n  // Retire le bouton principal pour libérer de la place\n  removeButtonSafe(MAIN_TP_BTN_ID);\n\n  tpPage = 0;\n  drawTpButtons();\n}\n\nfunction closeTeleportMenu() {\n  removeTpButtons();\n  tpOpen = false;\n\n  // Ré-ajoute le bouton principal\n  addButtonSafe({\n    id: MAIN_TP_BTN_ID,\n    label: \"Téléportation\",\n    bgColor: \"#2ea7ff\",\n    isGradient: true,\n    onClick: () => openTeleportMenu(),\n  });\n}\n\nfunction drawTpButtons() {\n  removeTpButtons();\n\n  const totalPages = Math.max(1, Math.ceil(ZONES.length / PER_PAGE));\n  tpPage = Math.max(0, Math.min(tpPage, totalPages - 1));\n\n  const start = tpPage * PER_PAGE;\n  const slice = ZONES.slice(start, start + PER_PAGE);\n\n  // ◀ Précédent\n  if (tpPage > 0) addTpBtn(\"tp-prev\", \"◀\", () => { tpPage -= 1; drawTpButtons(); });\n\n  // Boutons de zones de la page\n  slice.forEach((z, i) => {\n    addTpBtn(`tp-z-${start + i}`, z.label, () => {\n      try { WA.nav.goToRoom(MAP_URL + z.id); } catch (e) { L.err(\"goToRoom error:\", e); }\n      closeTeleportMenu();\n    });\n  });\n\n  // ▶ Suivant\n  if (tpPage < totalPages - 1) addTpBtn(\"tp-next\", \"▶\", () => { tpPage += 1; drawTpButtons(); });\n\n  // ✖ Fermer\n  addTpBtn(\"tp-close\", \"✖\", () => closeTeleportMenu());\n\n  L.log(`TP menu page ${tpPage + 1}/${totalPages}`);\n}\n\nfunction addTpBtn(id: string, label: string, cb: () => void) {\n  tpButtonIds.push(id);\n  const ab: any = (WA.ui as any)?.actionBar;\n  try { ab.addButton({ id, label, callback: cb, clickCallback: cb }); } catch (e) {\n    L.err(`Ajout bouton ${id} impossible:`, e);\n  }\n}\nfunction removeTpButtons() {\n  const ab: any = (WA.ui as any)?.actionBar;\n  tpButtonIds.forEach((id) => { try { ab.removeButton?.(id); } catch {} });\n  tpButtonIds = [];\n}\n\nexport {};\n"],"names":["L","a","MAP_URL","ZONES","PER_PAGE","waitForActionBar","maxTries","delayMs","resolve","reject","tries","tick","_a","ab","addButtonSafe","opts","_b","base","removeButtonSafe","id","MAIN_TP_BTN_ID","tpOpen","tpPage","tpButtonIds","unregisterMenu","registerMenuCommands","openTeleportMenu","e","u","unregTp","z","unreg","e2","drawTpButtons","closeTeleportMenu","removeTpButtons","totalPages","start","slice","addTpBtn","i","label","cb"],"mappings":"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"}