{"version":3,"file":"main-095d4efa.js","sources":["../../src/main.ts"],"sourcesContent":["/// <reference types=\"@workadventure/iframe-api-typings\" />\n\n/* ============ LOGS ============ */\nconst L = {\n  log: (...a: any[]) => console.log(\"[WA]\", ...a),\n  err: (...a: any[]) => console.error(\"[WA]\", ...a),\n};\n\n/* ============ CONFIG ============ */\nconst MAP_URL = \"/@/ynov-1733302243/ynov_adventure/new-map\";\nconst ZONES: { id: string; label: string }[] = [\n  { id: \"#TPA-IA\",     label: \"IA\" },\n  { id: \"#TPAINFO\",    label: \"Informatique\" },\n  { id: \"#TPACYBER\",   label: \"Cybersécurité\" },\n  { id: \"#TPAARCHI\",   label: \"Architecture\" },\n  { id: \"#TPABIM\",     label: \"Bâtiment Numérique\" },\n  { id: \"#TPAAUDIO\",   label: \"Audiovisuel\" },\n  { id: \"#TPADIGITAL\", label: \"DIGITAL IA\" },\n  { id: \"#TPA3D\",      label: \"3D\" },\n  { id: \"#TPAHUB\",     label: \"Accueil\" },\n];\n\n/* ============ HELPERS ============ */\n/** Ajoute un bouton. Si l’instance refuse la couleur/gradient, on retente sans style. */\nfunction addButtonSafe(opts: {\n  id: string;\n  label: string;\n  onClick: () => void;\n  bgColor?: string;\n  isGradient?: boolean;\n}) {\n  const ab: any = (WA.ui as any)?.actionBar;\n  if (!ab?.addButton) {\n    L.err(\"actionBar.addButton introuvable\");\n    return;\n  }\n  const base: any = { id: opts.id, label: opts.label, callback: opts.onClick, clickCallback: opts.onClick };\n  try {\n    if (opts.bgColor !== undefined) base.bgColor = opts.bgColor;\n    if (opts.isGradient !== undefined) base.isGradient = opts.isGradient;\n    ab.addButton(base);\n    L.log(`Button added: ${opts.id} (with style if supported)`);\n  } catch (e) {\n    // Retente sans style\n    try {\n      ab.addButton({ id: opts.id, label: opts.label, callback: opts.onClick, clickCallback: opts.onClick });\n      L.log(`Button added: ${opts.id} (fallback no-style)`);\n    } catch (e2) {\n      L.err(`Failed to add button ${opts.id}:`, e2);\n    }\n  }\n}\nfunction removeButtonSafe(id: string) {\n  const ab: any = (WA.ui as any)?.actionBar;\n  try { ab?.removeButton?.(id); } catch {}\n}\n\n/* ======= ÉTAT TÉLÉPORTATION ======= */\nconst MAIN_TP_BTN_ID = \"teleport-btn\";\nlet tpOpen = false;\nlet tpPage = 0;\nlet tpButtonIds: string[] = [];\n\n// Pagination : 1/pg sur mobile, 3/pg sur desktop\nfunction computePerPage(): number {\n  try {\n    if (/Mobi|Android/i.test(navigator.userAgent)) return 1;\n    if (typeof window !== \"undefined\" && window.innerWidth < 768) return 1;\n    if (window.matchMedia && window.matchMedia(\"(pointer:coarse)\").matches) return 1;\n  } catch {}\n  return 3;\n}\nlet PER_PAGE = computePerPage();\n\n/* ============ INIT ============ */\nWA.onInit().then(() => {\n  L.log(\"onInit OK\");\n\n  // Bouton TÉLÉPORTATION (disparaît quand le menu est ouvert)\n  addButtonSafe({\n    id: MAIN_TP_BTN_ID,\n    label: \"Téléportation\",\n    bgColor: \"#2ea7ff\",\n    isGradient: true,\n    onClick: () => openTeleportMenu(),\n  });\n\n  L.log(\"Buttons added\");\n}).catch((e) => L.err(\"onInit error:\", e));\n\n/* ============ TÉLÉPORTATION (action bar paginée) ============ */\nfunction openTeleportMenu() {\n  if (tpOpen) return;\n  tpOpen = true;\n\n  removeButtonSafe(MAIN_TP_BTN_ID);\n\n  tpPage = 0;\n  PER_PAGE = computePerPage();\n  drawTpButtons();\n}\n\nfunction closeTeleportMenu() {\n  removeTpButtons();\n  tpOpen = false;\n\n  addButtonSafe({\n    id: MAIN_TP_BTN_ID,\n    label: \"Téléportation\",\n    bgColor: \"#2ea7ff\",\n    isGradient: true,\n    onClick: () => openTeleportMenu(),\n  });\n}\n\nfunction drawTpButtons() {\n  removeTpButtons();\n\n  const totalPages = Math.max(1, Math.ceil(ZONES.length / PER_PAGE));\n  tpPage = Math.max(0, Math.min(tpPage, totalPages - 1));\n\n  const start = tpPage * PER_PAGE;\n  const slice = ZONES.slice(start, start + PER_PAGE);\n\n  if (tpPage > 0) addTpBtn(\"tp-prev\", \"◀\", () => { tpPage -= 1; drawTpButtons(); });\n\n  slice.forEach((z, i) => {\n    addTpBtn(`tp-z-${start + i}`, z.label, () => {\n      try { WA.nav.goToRoom(MAP_URL + z.id); } catch (e) { L.err(\"goToRoom error:\", e); }\n      closeTeleportMenu();\n    });\n  });\n\n  if (tpPage < totalPages - 1) addTpBtn(\"tp-next\", \"▶\", () => { tpPage += 1; drawTpButtons(); });\n\n  addTpBtn(\"tp-close\", \"✖\", () => closeTeleportMenu());\n\n  L.log(`TP menu page ${tpPage + 1}/${totalPages}, PER_PAGE=${PER_PAGE}`);\n}\n\nfunction addTpBtn(id: string, label: string, cb: () => void) {\n  tpButtonIds.push(id);\n  const ab: any = (WA.ui as any)?.actionBar;\n  try {\n    ab.addButton({ id, label, callback: cb, clickCallback: cb });\n  } catch (e) {\n    L.err(`Failed to add TP sub-button ${id}:`, e);\n  }\n}\nfunction removeTpButtons() {\n  const ab: any = (WA.ui as any)?.actionBar;\n  tpButtonIds.forEach((id) => { try { ab.removeButton?.(id); } catch {} });\n  tpButtonIds = [];\n}\n\nexport {};\n"],"names":["L","a","MAP_URL","ZONES","addButtonSafe","opts","_a","ab","base","e2","removeButtonSafe","id","_b","MAIN_TP_BTN_ID","tpOpen","tpPage","tpButtonIds","computePerPage","PER_PAGE","openTeleportMenu","e","drawTpButtons","closeTeleportMenu","removeTpButtons","totalPages","start","slice","addTpBtn","z","i","label","cb"],"mappings":"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"}