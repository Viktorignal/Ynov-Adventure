{"version":3,"file":"main-d74ecd31.js","sources":["../../src/main.ts"],"sourcesContent":["/// <reference types=\"@workadventure/iframe-api-typings\" />\n\n/* ============ LOGS ============ */\nconst L = {\n  log: (...a: any[]) => console.log(\"[WA]\", ...a),\n  err: (...a: any[]) => console.error(\"[WA]\", ...a),\n};\n\n/* ============ CONFIG ============ */\nconst MAP_URL = \"/@/ynov-1733302243/ynov_adventure/new-map\";\nconst ZONES: { id: string; label: string }[] = [\n  { id: \"#TPA-IA\", label: \"IA\" },\n  { id: \"#TPAINFO\", label: \"Informatique\" },\n  { id: \"#TPACYBER\", label: \"Cybersécurité\" },\n  { id: \"#TPAARCHI\", label: \"Architecture\" },\n  { id: \"#TPABIM\", label: \"Bâtiment Numérique\" },\n  { id: \"#TPAAUDIO\", label: \"Audiovisuel\" },\n  { id: \"#TPADIGITAL\", label: \"DIGITAL IA\" },\n  { id: \"#TPA3D\", label: \"3D\" },\n  { id: \"#TPAHUB\", label: \"Accueil\" },\n];\n\n/* ============ HELPERS ============ */\n// Attend que WA.ui.actionBar soit disponible (polling max ~5s)\nfunction waitForActionBar(maxTries = 25, delayMs = 200): Promise<void> {\n  return new Promise((resolve, reject) => {\n    let tries = 0;\n    const tick = () => {\n      const ab: any = (WA.ui as any)?.actionBar;\n      if (ab?.addButton) return resolve();\n      tries++;\n      if (tries >= maxTries) return reject(new Error(\"actionBar indisponible\"));\n      setTimeout(tick, delayMs);\n    };\n    tick();\n  });\n}\n\nfunction addButtonSafe(opts: {\n  id: string;\n  label: string;\n  onClick: () => void;\n  bgColor?: string;\n  isGradient?: boolean;\n}) {\n  const ab: any = (WA.ui as any)?.actionBar;\n  if (!ab?.addButton) {\n    L.err(\"actionBar.addButton introuvable\");\n    return;\n  }\n  // Évite les doublons si le script est rechargé\n  try { ab.removeButton?.(opts.id); } catch {}\n\n  const base: any = {\n    id: opts.id,\n    label: opts.label,\n    callback: opts.onClick,\n    clickCallback: opts.onClick,\n  };\n\n  try {\n    if (opts.bgColor !== undefined) base.bgColor = opts.bgColor;\n    if (opts.isGradient !== undefined) base.isGradient = opts.isGradient;\n    ab.addButton(base);\n    L.log(`Bouton ajouté: ${opts.id}`);\n  } catch (e) {\n    // Fallback sans style si l’instance ne supporte pas les props\n    try {\n      ab.addButton({\n        id: opts.id,\n        label: opts.label,\n        callback: opts.onClick,\n        clickCallback: opts.onClick,\n      });\n      L.log(`Bouton ajouté (fallback): ${opts.id}`);\n    } catch (e2) {\n      L.err(`Échec ajout bouton ${opts.id}:`, e2);\n    }\n  }\n}\n\n/* ======= ÉTAT TÉLÉPORTATION ======= */\nconst MAIN_TP_BTN_ID = \"teleport-btn\";\nlet tpOpen = false;\nlet tpButtonIds: string[] = [];\n\n/* ============ INIT ============ */\nWA.onInit()\n  .then(() => waitForActionBar())\n  .then(() => {\n    addButtonSafe({\n      id: MAIN_TP_BTN_ID,\n      label: \"Téléportation\",\n      bgColor: \"#2ea7ff\",\n      isGradient: true,\n      onClick: () => toggleTeleportMenu(),\n    });\n    L.log(\"Action bar prête, bouton Téléportation ajouté.\");\n  })\n  .catch((e) => L.err(\"Init UI/actionBar error:\", e));\n\n/* ============ TÉLÉPORTATION (sans pagination, WA gère l’affichage) ============ */\nfunction toggleTeleportMenu() {\n  if (tpOpen) closeTeleportMenu();\n  else openTeleportMenu();\n}\n\nfunction openTeleportMenu() {\n  if (tpOpen) return;\n  tpOpen = true;\n  drawTpButtons();\n}\n\nfunction closeTeleportMenu() {\n  removeTpButtons();\n  tpOpen = false;\n}\n\nfunction drawTpButtons() {\n  removeTpButtons();\n\n  // Crée un bouton pour chaque zone\n  ZONES.forEach((z, idx) => {\n    addTpBtn(`tp-z-${idx}`, z.label, () => {\n      try {\n        WA.nav.goToRoom(MAP_URL + z.id);\n      } catch (e) {\n        L.err(\"goToRoom error:\", e);\n      }\n      closeTeleportMenu();\n    });\n  });\n\n  // Bouton de fermeture\n  addTpBtn(\"tp-close\", \"✖\", () => closeTeleportMenu());\n}\n\nfunction addTpBtn(id: string, label: string, cb: () => void) {\n  tpButtonIds.push(id);\n  const ab: any = (WA.ui as any)?.actionBar;\n  try {\n    ab.addButton({ id, label, callback: cb, clickCallback: cb });\n  } catch (e) {\n    L.err(`Erreur lors de l'ajout du bouton ${id}:`, e);\n  }\n}\n\nfunction removeTpButtons() {\n  const ab: any = (WA.ui as any)?.actionBar;\n  tpButtonIds.forEach((id) => {\n    try { ab.removeButton?.(id); } catch {}\n  });\n  tpButtonIds = [];\n}\n\nexport {};\n"],"names":["L","a","MAP_URL","ZONES","waitForActionBar","maxTries","delayMs","resolve","reject","tries","tick","_a","ab","addButtonSafe","opts","_b","base","e2","MAIN_TP_BTN_ID","tpOpen","tpButtonIds","toggleTeleportMenu","e","closeTeleportMenu","openTeleportMenu","drawTpButtons","removeTpButtons","z","idx","addTpBtn","id","label","cb"],"mappings":"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"}