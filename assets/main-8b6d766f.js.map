{"version":3,"file":"main-8b6d766f.js","sources":["../../src/main.ts"],"sourcesContent":["/// <reference types=\"@workadventure/iframe-api-typings\" />\n\n/* ============ LOGS ============ */\nconst L = {\n  log: (...a: any[]) => console.log(\"[WA]\", ...a),\n  err: (...a: any[]) => console.error(\"[WA]\", ...a),\n};\n\n/* ============ CONFIG ============ */\nconst MAP_URL = \"/@/ynov-1733302243/ynov_adventure/new-map\";\nconst ZONES: { id: string; label: string }[] = [\n  { id: \"#TPA-IA\", label: \"IA\" },\n  { id: \"#TPAINFO\", label: \"Informatique\" },\n  { id: \"#TPACYBER\", label: \"Cybersécurité\" },\n  { id: \"#TPAARCHI\", label: \"Architecture\" },\n  { id: \"#TPABIM\", label: \"Bâtiment Numérique\" },\n  { id: \"#TPAAUDIO\", label: \"Audiovisuel\" },\n  { id: \"#TPADIGITAL\", label: \"DIGITAL IA\" },\n  { id: \"#TPA3D\", label: \"3D\" },\n  { id: \"#TPAHUB\", label: \"Accueil\" },\n];\n\n/* ============ HELPERS ============ */\n// Attend l'action bar si nécessaire\nfunction waitForActionBar(maxTries = 25, delayMs = 200): Promise<void> {\n  return new Promise((resolve, reject) => {\n    let tries = 0;\n    const tick = () => {\n      const ab: any = (WA.ui as any)?.actionBar;\n      if (ab?.addButton) return resolve();\n      tries++;\n      if (tries >= maxTries) return reject(new Error(\"actionBar indisponible\"));\n      setTimeout(tick, delayMs);\n    };\n    tick();\n  });\n}\n\nfunction addButtonSafe(opts: {\n  id: string;\n  label: string;\n  onClick: () => void;\n  bgColor?: string;\n  isGradient?: boolean;\n}) {\n  const ab: any = (WA.ui as any)?.actionBar;\n  if (!ab?.addButton) {\n    L.err(\"actionBar.addButton introuvable\");\n    return;\n  }\n  try { ab.removeButton?.(opts.id); } catch {}\n\n  const base: any = {\n    id: opts.id,\n    label: opts.label,\n    callback: opts.onClick,\n    clickCallback: opts.onClick,\n  };\n\n  try {\n    if (opts.bgColor !== undefined) base.bgColor = opts.bgColor;\n    if (opts.isGradient !== undefined) base.isGradient = opts.isGradient;\n    ab.addButton(base);\n  } catch {\n    try {\n      ab.addButton({\n        id: opts.id,\n        label: opts.label,\n        callback: opts.onClick,\n        clickCallback: opts.onClick,\n      });\n    } catch (e2) {\n      L.err(`Échec ajout bouton ${opts.id}:`, e2);\n    }\n  }\n}\n\n/* ======= ÉTAT TÉLÉPORTATION ======= */\nconst MAIN_TP_BTN_ID = \"teleport-btn\";\nlet tpOpen = false;\nlet tpButtonIds: string[] = [];\nlet unregisterMenu: Array<() => void> = [];\n\n/* ============ INIT ============ */\nWA.onInit()\n  .then(() => {\n    // 1) Enregistre les entrées PERMANENTES dans le menu des paramètres\n    registerMenuCommands();\n\n    // 2) Assure l’action bar et ajoute le bouton “Téléportation”\n    return waitForActionBar();\n  })\n  .then(() => {\n    addButtonSafe({\n      id: MAIN_TP_BTN_ID,\n      label: \"Téléportation\",\n      bgColor: \"#2ea7ff\",\n      isGradient: true,\n      onClick: () => toggleTeleportMenu(),\n    });\n  })\n  .catch((e) => L.err(\"Init error:\", e));\n\n/* ============ MENU PARAMÈTRES ============ */\nfunction registerMenuCommands() {\n  // Nettoie si ré-enregistré\n  if (unregisterMenu.length) {\n    unregisterMenu.forEach((u) => { try { u(); } catch {} });\n    unregisterMenu = [];\n  }\n\n  // Entrée “Téléportation” (ouvre/ferme le menu d’actions)\n  try {\n    const unregTp = WA.ui.registerMenuCommand(\"Téléportation\", () => toggleTeleportMenu());\n    if (typeof unregTp === \"function\") unregisterMenu.push(unregTp);\n  } catch (e) {\n    L.err(\"registerMenuCommand Teleportation error:\", e);\n  }\n\n  // Une entrée par zone — toujours présentes dans les paramètres\n  ZONES.forEach((z) => {\n    try {\n      const unreg = WA.ui.registerMenuCommand(z.label, () => {\n        try { WA.nav.goToRoom(MAP_URL + z.id); } catch (e2) { L.err(\"goToRoom error:\", e2); }\n      });\n      if (typeof unreg === \"function\") unregisterMenu.push(unreg);\n    } catch (e) {\n      L.err(`registerMenuCommand ${z.label} error:`, e);\n    }\n  });\n}\n\n/* ============ TÉLÉPORTATION (Action Bar) ============ */\nfunction toggleTeleportMenu() {\n  if (tpOpen) closeTeleportMenu();\n  else openTeleportMenu();\n}\n\nfunction openTeleportMenu() {\n  if (tpOpen) return;\n  tpOpen = true;\n  drawTpButtons();\n}\n\nfunction closeTeleportMenu() {\n  removeTpButtons();\n  tpOpen = false;\n}\n\nfunction drawTpButtons() {\n  removeTpButtons();\n\n  // Crée un bouton pour chaque zone (en haut, dans l’action bar)\n  ZONES.forEach((z, idx) => {\n    addTpBtn(`tp-z-${idx}`, z.label, () => {\n      try { WA.nav.goToRoom(MAP_URL + z.id); } catch (e) { L.err(\"goToRoom error:\", e); }\n      closeTeleportMenu();\n    });\n  });\n\n  // Bouton de fermeture\n  addTpBtn(\"tp-close\", \"✖\", () => closeTeleportMenu());\n}\n\nfunction addTpBtn(id: string, label: string, cb: () => void) {\n  tpButtonIds.push(id);\n  const ab: any = (WA.ui as any)?.actionBar;\n  try {\n    ab.addButton({ id, label, callback: cb, clickCallback: cb });\n  } catch (e) {\n    L.err(`Erreur lors de l'ajout du bouton ${id}:`, e);\n  }\n}\n\nfunction removeTpButtons() {\n  const ab: any = (WA.ui as any)?.actionBar;\n  tpButtonIds.forEach((id) => { try { ab.removeButton?.(id); } catch {} });\n  tpButtonIds = [];\n}\n\nexport {};\n"],"names":["L","a","MAP_URL","ZONES","waitForActionBar","maxTries","delayMs","resolve","reject","tries","tick","_a","ab","addButtonSafe","opts","_b","base","e2","MAIN_TP_BTN_ID","tpOpen","tpButtonIds","unregisterMenu","registerMenuCommands","toggleTeleportMenu","u","unregTp","z","unreg","e","closeTeleportMenu","openTeleportMenu","drawTpButtons","removeTpButtons","idx","addTpBtn","id","label","cb"],"mappings":"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"}